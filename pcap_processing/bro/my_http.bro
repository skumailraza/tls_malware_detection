##! Extract additional HTTP headers and add to the logging stream

@load base/protocols/http/main

module HTTP;

export {
	redef record Info += {
		## The Server header value in the HTTP response
		server:  string &log &optional;
		## The Location header value in the HTTP response
		location:  string &log &optional;
		## The Content-Type header value in the HTTP request
		req_content_type:  string &log &optional;
		## The Content-Type header value in the HTTP response
		resp_content_type:  string &log &optional;
		
	};
	
}

event http_header(c: connection, is_orig: bool, name: string, value: string) &priority=3
	{
  # HTTP request
  if ( is_orig )
    if ( name == "CONTENT-TYPE" )
      c$http$req_content_type = value;

  # HTTP response
  else
    # Store Server header value
    if ( name == "SERVER" )
      c$http$server = value;

    # Store Location header value
    if ( name == "LOCATION" )
      c$http$location = value;
	
    # Store Content-Type header value
    if ( name == "CONTENT-TYPE" )
      c$http$resp_content_type = value;
	}

