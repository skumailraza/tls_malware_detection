#!/bin/bash

WORKWITH=`basename $1`

if [ -d "$WORKWITH" ]; then
	echo "Parsing pcaps in $WORKWITH"
else
	echo 'Folder with pcaps missed. Aborting.'
	exit 1
fi

CURDIR=`pwd`

# Put here the absolute path to the repo
BASE_DIR="$HOME/Code/exec_clustering/"

LOGS="$CURDIR/$WORKWITH"
LOGS_CERTS="$CURDIR/$WORKWITH"_certs
LOGS_AVC="$CURDIR/$WORKWITH".labels
LOGS_VT="$CURDIR/$WORKWITH".vt
LOGS_JSON="$CURDIR/$WORKWITH".json

cd $BASE_DIR/pcap_processing
python2.7 parse_bro_logs_v2.py --dir $LOGS --ofile $LOGS_JSON --dcerts $LOGS_CERTS 2> $CURDIR/parse_bro_logs_v2_"$WORKWITH".err

cd $BASE_DIR/clustering/prep
python2.7 extract_features.py --logs $LOGS_JSON --certs $LOGS_CERTS --avc $LOGS_AVC --vt $LOGS_VT --fprints ../data/tls_fprints/imc18_tls_fprints.db 1> "$CURDIR/$WORKWITH".tsv 2> $CURDIR/extract_features_"$WORKWITH".err

